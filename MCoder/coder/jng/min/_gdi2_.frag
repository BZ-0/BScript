#version 300 es
precision highp float;precision highp int;precision highp sampler2D;precision highp usampler2D;in highp vec2 texcoord;uniform highp sampler2D img_rgb,img_a;layout(location=0) out highp vec4 fragColor;uniform vec2 rxy,gxy,bxy,wxy;uniform float gamma;void main(){mat3x4 v=transpose(mat4x3(vec3(rxy,1.f-rxy.x-rxy.y),vec3(gxy,1.f-gxy.x-gxy.y),vec3(bxy,1.f-bxy.x-bxy.y),vec3(0)));vec4 y=vec4(wxy,1.f-wxy.x-wxy.y,wxy.y)*inverse(mat4x4(v[0],v[1],v[2],vec4(0,0,0,1))),u;for(uint h=0u;h<3u;h++)for(uint f=0u;f<3u;f++)v[f][h]*=y[h]/y.w;u=vec4(texture(img_rgb,texcoord.xy).xyz*mat3x3(.4124564,.3575761,.1804375,.2126729,.7151522,.072175,.0193339,.119192,.9503041),1)*inverse(mat4x4(v[0],v[1],v[2],vec4(0,0,0,1)));fragColor=vec4(pow(u.xyz,vec3(.45f/gamma)),texture(img_a,texcoord.xy).x);}