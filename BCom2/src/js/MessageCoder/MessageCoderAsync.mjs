// @ts-nocheck
"use strict"

//
import { msgpackM } from "../Library/Imports.mjs"
import AutoDetector from "../Reflection/AutoDetector.mjs"
import { _LOG_ } from "../Library/Symbols.mjs"
import { $unwrap } from "../Reflection/PromiseReflection.mjs"
import { wrapFunc, AccessReflection } from "../Reflection/DirectReflection.mjs"
import SyncPromise, { $getter } from "../Library/SyncPromise.mjs"

// for protocol
export default class MessageCoderAsync {
    /** @type {AutoDetector} */
    $detector = null

    /** @type {ReferenceDictionary} */
    $dictionary = null

    /** @type {MessageHandler} */
    $messageHandler = null

    /** @type {RequestReflection} */
    $requestReflect = null

    /** @type {IndirectReflection} */
    $indirectReflect = null

    /** @type {PromiseReflection} */
    $promiseReflect = null

    //
    $encodingRules = new Map([])
    $decodingRules = new Map([])
    $transcodingRules = new Map([])

    //
    $encode = null
    $decode = null
    $msgpck = null

    //
    $proxify = null
    $handler = null

    //
    constructor({ $detector, $dictionary, $requestReflect, $indirectReflect, $promiseReflect, $encode, $decode, $handler }) {
        this.$dictionary = $dictionary
        this.$detector = $detector
        this.$requestReflect = $requestReflect
        this.$indirectReflect = $indirectReflect
        this.$promiseReflect = $promiseReflect
        this.$encode = $encode
        this.$decode = $decode
        this.$msgpck = msgpackM
        this.$handler = $handler

        //
        const $proxify = async ([$code, $shared], { $untyped }) => {
            return this.$dictionary.$temp(
                $getter($untyped),
                {
                    ["&origin"]: $code?.["&proxy"],
                    ["&root"]: $code?.["&root"] ?? $code?.["&origin"],
                    ["&persistent"]: $code?.["&persistent"]
                },
                $untyped
            )?.["&code"]
        }

        //
        this.$encodingRules = new Map([
            //
            [
                "array",
                ([_, $shared], { $untyped }) => {
                    return Promise.all($untyped.map((e) => this.encodeMember(e, $shared)))
                }
            ],
            ["worker", $proxify],
            ["socket", $proxify],
            ["class", $proxify],
            ["proxy", $proxify],
            ["transfer", $proxify],
            ["shared", $proxify],

            //
            [
                "promise",
                ([$code, $shared], { $untyped }) => {
                    return this.$dictionary.$temp(
                        $getter($untyped),
                        {
                            ["&typeof"]: "access",
                            ["&origin"]: $code?.["&proxy"],
                            ["&root"]: $code?.["&root"] ?? $code?.["&origin"],
                            ["&persistent"]: $code?.["&persistent"]
                        },
                        $untyped
                    )?.["&code"]
                }
            ],

            // i.e. copy policy
            [
                "typedarray",
                ([_], { $wrap }) => {
                    return $wrap?.["&data"]
                }
            ],

            //
            [
                "object",
                ([_, $shared], { $untyped }) => {
                    return Promise.all(
                        Object.entries($untyped).map((pair) => {
                            return [pair[0], this.encodeMember(pair[1], $shared)]
                        })
                    ).then(($) => {
                        return Object.fromEntries($)
                    })
                }
            ]
        ])

        //
        this.$decodingRules = new Map([
            [
                "class",
                ([_]) => {
                    throw Error("Currently, class can't to be a decodable!")
                }
            ],

            //
            [
                "access",
                async ([coded, shared]) => {
                    // when async mode, access should to be also decoded
                    return this.decodeMember(await new Proxy(coded, new AccessReflection(Reflect, this.$handler)), shared)
                }
            ],

            //
            [
                "proxy",
                ([coded]) => {
                    const hasOrigin = this.$dictionary.$get(coded?.["&root"], coded?.["&persistent"]) ?? this.$dictionary.$get(coded?.["&origin"], coded?.["&persistent"]) ?? this.$dictionary.$get(coded?.["&proxy"], coded?.["&persistent"])

                    //
                    if (hasOrigin) {
                        return hasOrigin
                    }

                    //
                    return new Proxy(
                        wrapFunc({
                            ["&data"]: null,
                            ["&code"]: coded
                        }),
                        this.$requestReflect
                    )
                }
            ],
            [
                "array",
                ([coded, shared]) => {
                    return Promise.all((coded["&data"] ?? coded).map((m) => this.decodeMember(m, shared)))
                }
            ],
            [
                "object",
                ([coded, shared]) => {
                    return Promise.all(
                        Object.entries(coded["&data"] ?? coded).map((pair) => {
                            return [pair[0], this.decodeMember(pair[1], shared)]
                        })
                    ).then(($) => {
                        return Object.fromEntries($)
                    })
                }
            ],
            [
                "typedarray",
                ([coded]) => {
                    return coded?.["&data"] ?? coded
                }
            ]
        ])

        //
        this.$transcodingRules = new Map([])
    }

    //
    async decodeMessage([$message, $buffer = null], $shared = []) {
        const _unwrap_ = await (
            this.$decode ||
            (async (e) => {
                return (await this.$msgpck)?.decode(e, { useBigInt64: true })
            })
        )?.(await $message)
        _unwrap_.$args = await Promise.all(_unwrap_.$args?.map?.((m) => this.decodeMember(m, $shared)) ?? [])
        return [[_unwrap_, $buffer], $shared.concat([$buffer])]
    }

    // TODO! Needs client-side error handling...
    decodeError(..._) {
        throw Error("Unhandled internal error...")
    }

    //
    async encodeError([$data, $buffer], $shared = []) {
        delete $data?.$args
        delete $data?.["&data"]
        const _wrap_ = await (
            this.$encode ||
            (async (e) => {
                return (await this.$msgpck)?.encode(e, { useBigInt64: true })
            })
        )?.($data)
        return [[_wrap_, $buffer], $shared.concat([_wrap_.buffer, $buffer])]
    }

    //
    async decodeMember(coded, shared = []) {
        // if is null, prefer don't decode...
        coded = await coded
        if (!coded || ["object", "function"].indexOf(typeof coded) < 0) return coded
        if (!coded?.["&typeof"]) coded = new AutoDetector(coded)["&code"]

        //
        const $sender = this?.$getDataChannel?.(coded?.["&meta"])
        const $recode = await (this.$decodingRules.get(coded?.["&typeof"])?.([coded, shared], { $sender }) ?? coded?.["&data"] ?? coded)
        $sender?.$finalizer?.($recode)
        return $recode
    }

    //
    async encodeMessage([$data, $buffer = null, $receive = false], $shared = []) {
        //$data.$worker = await $data.$worker;
        $data.$args = await Promise.all($data.$args?.map?.((e) => this.encodeMember(e, $shared)) ?? [])
        const _wrap_ = (this.$encode || this.$msgpck?.encode)($data, { useBigInt64: true })

        //
        if ($receive) {
            // when received by remote, need to copy buffer
            if ($buffer.byteLength - 8 < _wrap_.byteLength) $buffer.grow(_wrap_.byteLength + 8)
            const _copy_ = new Uint8Array($buffer, 8, _wrap_.byteLength)
            _copy_.set(_wrap_)
            const _len_ = new Uint32Array($buffer, 0, 1)
            if (typeof Atomics != "undefined") {
                Atomics.store(_len_, 0, _wrap_.byteLength)
            } else {
                _len_[0] = _wrap_.byteLength
            }
            return [[_copy_, $buffer], $shared.concat([_copy_.buffer, $buffer])]
        } else {
            const _copy_ = new Uint8Array(_wrap_)
            return [[_copy_, $buffer], $shared.concat([_copy_.buffer, $buffer])]
        }
    }

    //
    async encodeMember($wrap, $shared = []) {
        if (["transfer", "promise", "proxy"].indexOf($wrap?.["&typeof"]) < 0) {
            $wrap = await $unwrap(await $wrap)
        }
        if (!$wrap || ["object", "function"].indexOf(typeof $wrap) < 0) return $wrap

        //
        const $untyped = $wrap
        let $typeof = $wrap?.["&typeof"]
        if (!$typeof) {
            $wrap = new AutoDetector($wrap)
            $typeof = $wrap?.["&typeof"]
        }

        //
        const $code = $wrap["&code"]
        const $receiver = await this?.$getDataChannel?.($untyped?.["&meta"])
        $receiver?.$finalizer?.($untyped)
        return this.$encodingRules.get($typeof)?.([$code, $shared], { $wrap, $receiver, $untyped }) ?? $wrap?.["&data"]
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtc2dwYWNrTSIsIkF1dG9EZXRlY3RvciIsIl9MT0dfIiwiJHVud3JhcCIsIndyYXBGdW5jIiwiQWNjZXNzUmVmbGVjdGlvbiIsIlN5bmNQcm9taXNlIiwiJGdldHRlciIsIk1lc3NhZ2VDb2RlckFzeW5jIiwiJGRldGVjdG9yIiwiJGRpY3Rpb25hcnkiLCIkbWVzc2FnZUhhbmRsZXIiLCIkcmVxdWVzdFJlZmxlY3QiLCIkaW5kaXJlY3RSZWZsZWN0IiwiJHByb21pc2VSZWZsZWN0IiwiJGVuY29kaW5nUnVsZXMiLCJNYXAiLCIkZGVjb2RpbmdSdWxlcyIsIiR0cmFuc2NvZGluZ1J1bGVzIiwiJGVuY29kZSIsIiRkZWNvZGUiLCIkbXNncGNrIiwiJHByb3hpZnkiLCIkaGFuZGxlciIsImNvbnN0cnVjdG9yIiwiJGNvZGUiLCIkc2hhcmVkIiwiJHVudHlwZWQiLCIkdGVtcCIsIl8iLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZSIsImVuY29kZU1lbWJlciIsIiR3cmFwIiwiT2JqZWN0IiwiZW50cmllcyIsInBhaXIiLCJ0aGVuIiwiJCIsImZyb21FbnRyaWVzIiwiRXJyb3IiLCJjb2RlZCIsInNoYXJlZCIsImRlY29kZU1lbWJlciIsIlByb3h5IiwiUmVmbGVjdCIsImhhc09yaWdpbiIsIiRnZXQiLCJtIiwiZGVjb2RlTWVzc2FnZSIsIiRtZXNzYWdlIiwiJGJ1ZmZlciIsIl91bndyYXBfIiwiZGVjb2RlIiwidXNlQmlnSW50NjQiLCIkYXJncyIsImNvbmNhdCIsImRlY29kZUVycm9yIiwiZW5jb2RlRXJyb3IiLCIkZGF0YSIsIl93cmFwXyIsImVuY29kZSIsImJ1ZmZlciIsImluZGV4T2YiLCIkc2VuZGVyIiwiJGdldERhdGFDaGFubmVsIiwiJHJlY29kZSIsImdldCIsIiRmaW5hbGl6ZXIiLCJlbmNvZGVNZXNzYWdlIiwiJHJlY2VpdmUiLCJieXRlTGVuZ3RoIiwiZ3JvdyIsIl9jb3B5XyIsIlVpbnQ4QXJyYXkiLCJzZXQiLCJfbGVuXyIsIlVpbnQzMkFycmF5IiwiQXRvbWljcyIsInN0b3JlIiwiJHR5cGVvZiIsIiRyZWNlaXZlciJdLCJzb3VyY2VzIjpbIkM6XFxQcm9qZWN0c1xcQlowXFxCQ29tMlxcc3JjXFxjaXZldFxcTWVzc2FnZUNvZGVyXFxNZXNzYWdlQ29kZXJBc3luYy5jaXZldCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtbm9jaGVja1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vXG5pbXBvcnQgeyBtc2dwYWNrTSB9IGZyb20gXCIuLi9MaWJyYXJ5L0ltcG9ydHNcIjtcbmltcG9ydCBBdXRvRGV0ZWN0b3IgZnJvbSBcIi4uL1JlZmxlY3Rpb24vQXV0b0RldGVjdG9yXCI7XG5pbXBvcnQgeyBfTE9HXyB9IGZyb20gXCIuLi9MaWJyYXJ5L1N5bWJvbHNcIjtcbmltcG9ydCB7ICR1bndyYXAgfSBmcm9tIFwiLi4vUmVmbGVjdGlvbi9Qcm9taXNlUmVmbGVjdGlvblwiO1xuaW1wb3J0IHsgd3JhcEZ1bmMsIEFjY2Vzc1JlZmxlY3Rpb24gfSBmcm9tIFwiLi4vUmVmbGVjdGlvbi9EaXJlY3RSZWZsZWN0aW9uXCI7XG5pbXBvcnQgU3luY1Byb21pc2UsIHsgJGdldHRlciB9IGZyb20gXCIuLi9MaWJyYXJ5L1N5bmNQcm9taXNlXCJcblxuLy8gZm9yIHByb3RvY29sXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNZXNzYWdlQ29kZXJBc3luYyB7XG4gICAgLyoqIEB0eXBlIHtBdXRvRGV0ZWN0b3J9ICovXG4gICAgJGRldGVjdG9yID0gbnVsbDtcblxuICAgIC8qKiBAdHlwZSB7UmVmZXJlbmNlRGljdGlvbmFyeX0gKi9cbiAgICAkZGljdGlvbmFyeSA9IG51bGw7XG5cbiAgICAvKiogQHR5cGUge01lc3NhZ2VIYW5kbGVyfSAqL1xuICAgICRtZXNzYWdlSGFuZGxlciA9IG51bGw7XG5cbiAgICAvKiogQHR5cGUge1JlcXVlc3RSZWZsZWN0aW9ufSAqL1xuICAgICRyZXF1ZXN0UmVmbGVjdCA9IG51bGw7XG5cbiAgICAvKiogQHR5cGUge0luZGlyZWN0UmVmbGVjdGlvbn0gKi9cbiAgICAkaW5kaXJlY3RSZWZsZWN0ID0gbnVsbDtcblxuICAgIC8qKiBAdHlwZSB7UHJvbWlzZVJlZmxlY3Rpb259ICovXG4gICAgJHByb21pc2VSZWZsZWN0ID0gbnVsbDtcblxuICAgIC8vXG4gICAgJGVuY29kaW5nUnVsZXMgPSBuZXcgTWFwKFtdKTtcbiAgICAkZGVjb2RpbmdSdWxlcyA9IG5ldyBNYXAoW10pO1xuICAgICR0cmFuc2NvZGluZ1J1bGVzID0gbmV3IE1hcChbXSk7XG5cbiAgICAvL1xuICAgICRlbmNvZGUgPSBudWxsO1xuICAgICRkZWNvZGUgPSBudWxsO1xuICAgICRtc2dwY2sgPSBudWxsO1xuXG4gICAgLy9cbiAgICAkcHJveGlmeSA9IG51bGw7XG4gICAgJGhhbmRsZXIgPSBudWxsO1xuXG4gICAgLy9cbiAgICBjb25zdHJ1Y3Rvcih7JGRldGVjdG9yLCAkZGljdGlvbmFyeSwgJHJlcXVlc3RSZWZsZWN0LCAkaW5kaXJlY3RSZWZsZWN0LCAkcHJvbWlzZVJlZmxlY3QsICRlbmNvZGUsICRkZWNvZGUsICRoYW5kbGVyfSkge1xuICAgICAgICB0aGlzLiRkaWN0aW9uYXJ5ID0gJGRpY3Rpb25hcnk7XG4gICAgICAgIHRoaXMuJGRldGVjdG9yID0gJGRldGVjdG9yO1xuICAgICAgICB0aGlzLiRyZXF1ZXN0UmVmbGVjdCA9ICRyZXF1ZXN0UmVmbGVjdDtcbiAgICAgICAgdGhpcy4kaW5kaXJlY3RSZWZsZWN0ID0gJGluZGlyZWN0UmVmbGVjdDtcbiAgICAgICAgdGhpcy4kcHJvbWlzZVJlZmxlY3QgPSAkcHJvbWlzZVJlZmxlY3Q7XG4gICAgICAgIHRoaXMuJGVuY29kZSA9ICRlbmNvZGU7XG4gICAgICAgIHRoaXMuJGRlY29kZSA9ICRkZWNvZGU7XG4gICAgICAgIHRoaXMuJG1zZ3BjayA9IG1zZ3BhY2tNO1xuICAgICAgICB0aGlzLiRoYW5kbGVyID0gJGhhbmRsZXI7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgJHByb3hpZnkgPSBhc3luYyAoWyRjb2RlLCAkc2hhcmVkXSwgeyR1bnR5cGVkfSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGRpY3Rpb25hcnkuJHRlbXAoJGdldHRlcigkdW50eXBlZCksIHtcbiAgICAgICAgICAgICAgICBbXCImb3JpZ2luXCJdOiAkY29kZT8uW1wiJnByb3h5XCJdLCBcbiAgICAgICAgICAgICAgICBbXCImcm9vdFwiXTogKCRjb2RlPy5bXCImcm9vdFwiXSA/PyAkY29kZT8uW1wiJm9yaWdpblwiXSksXG4gICAgICAgICAgICAgICAgW1wiJnBlcnNpc3RlbnRcIl06ICRjb2RlPy5bXCImcGVyc2lzdGVudFwiXVxuICAgICAgICAgICAgfSwgJHVudHlwZWQpPy5bXCImY29kZVwiXTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL1xuICAgICAgICB0aGlzLiRlbmNvZGluZ1J1bGVzID0gbmV3IE1hcChbXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgW1wiYXJyYXlcIiwgKFtfLCAkc2hhcmVkXSwgeyR1bnR5cGVkfSkgPT4geyByZXR1cm4gUHJvbWlzZS5hbGwoJHVudHlwZWQubWFwKChlKSA9PiB0aGlzLmVuY29kZU1lbWJlcihlLCAkc2hhcmVkKSkpOyB9XSxcbiAgICAgICAgICAgIFtcIndvcmtlclwiLCAkcHJveGlmeV0sXG4gICAgICAgICAgICBbXCJzb2NrZXRcIiwgJHByb3hpZnldLFxuICAgICAgICAgICAgW1wiY2xhc3NcIiwgJHByb3hpZnldLFxuICAgICAgICAgICAgW1wicHJveHlcIiwgJHByb3hpZnldLFxuICAgICAgICAgICAgW1widHJhbnNmZXJcIiwgJHByb3hpZnldLFxuICAgICAgICAgICAgW1wic2hhcmVkXCIsICRwcm94aWZ5XSxcblxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIFtcInByb21pc2VcIiwgKFskY29kZSwgJHNoYXJlZF0sIHskdW50eXBlZH0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZGljdGlvbmFyeS4kdGVtcCgkZ2V0dGVyKCR1bnR5cGVkKSwge1xuICAgICAgICAgICAgICAgICAgICBbXCImdHlwZW9mXCJdOiBcImFjY2Vzc1wiLFxuICAgICAgICAgICAgICAgICAgICBbXCImb3JpZ2luXCJdOiAkY29kZT8uW1wiJnByb3h5XCJdLCBcbiAgICAgICAgICAgICAgICAgICAgW1wiJnJvb3RcIl06ICgkY29kZT8uW1wiJnJvb3RcIl0gPz8gJGNvZGU/LltcIiZvcmlnaW5cIl0pLFxuICAgICAgICAgICAgICAgICAgICBbXCImcGVyc2lzdGVudFwiXTogJGNvZGU/LltcIiZwZXJzaXN0ZW50XCJdXG4gICAgICAgICAgICAgICAgfSwgJHVudHlwZWQpPy5bXCImY29kZVwiXTtcbiAgICAgICAgICAgIH1dLFxuXG4gICAgICAgICAgICAvLyBpLmUuIGNvcHkgcG9saWN5XG4gICAgICAgICAgICBbXCJ0eXBlZGFycmF5XCIsIChbX10sIHskd3JhcH0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKCAkd3JhcD8uW1wiJmRhdGFcIl0pO1xuICAgICAgICAgICAgfV0sXG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBbXCJvYmplY3RcIiwgKFtfLCAkc2hhcmVkXSwgeyR1bnR5cGVkfSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChPYmplY3QuZW50cmllcygkdW50eXBlZCkubWFwKCAocGFpcikgPT4geyByZXR1cm4gW3BhaXJbMF0sIHRoaXMuZW5jb2RlTWVtYmVyKHBhaXJbMV0sICRzaGFyZWQpXTsgfSkpLnRoZW4oKCQpPT57XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoJCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XSxcbiAgICAgICAgXSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgdGhpcy4kZGVjb2RpbmdSdWxlcyA9IG5ldyBNYXAoW1xuICAgICAgICAgICAgW1wiY2xhc3NcIiwgKFtfXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ3VycmVudGx5LCBjbGFzcyBjYW4ndCB0byBiZSBhIGRlY29kYWJsZSFcIik7XG4gICAgICAgICAgICB9XSxcblxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIFtcImFjY2Vzc1wiLCBhc3luYyAoW2NvZGVkLCBzaGFyZWRdKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gd2hlbiBhc3luYyBtb2RlLCBhY2Nlc3Mgc2hvdWxkIHRvIGJlIGFsc28gZGVjb2RlZFxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZU1lbWJlcihhd2FpdCBuZXcgUHJveHkoY29kZWQsIG5ldyBBY2Nlc3NSZWZsZWN0aW9uKFJlZmxlY3QsIHRoaXMuJGhhbmRsZXIpKSwgc2hhcmVkKTtcbiAgICAgICAgICAgIH1dLFxuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgW1wicHJveHlcIiwgKFtjb2RlZF0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNPcmlnaW4gPSBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZGljdGlvbmFyeS4kZ2V0KGNvZGVkPy5bXCImcm9vdFwiXSwgY29kZWQ/LltcIiZwZXJzaXN0ZW50XCJdKSA/PyBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZGljdGlvbmFyeS4kZ2V0KGNvZGVkPy5bXCImb3JpZ2luXCJdLCBjb2RlZD8uW1wiJnBlcnNpc3RlbnRcIl0pID8/IFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRkaWN0aW9uYXJ5LiRnZXQoY29kZWQ/LltcIiZwcm94eVwiXSwgY29kZWQ/LltcIiZwZXJzaXN0ZW50XCJdKTtcblxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgaWYgKGhhc09yaWdpbikgeyBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhc09yaWdpbjsgXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh3cmFwRnVuYyh7XG4gICAgICAgICAgICAgICAgICAgIFtcIiZkYXRhXCJdOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBbXCImY29kZVwiXTogY29kZWRcbiAgICAgICAgICAgICAgICB9KSwgdGhpcy4kcmVxdWVzdFJlZmxlY3QpO1xuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBbXCJhcnJheVwiLCAoW2NvZGVkLCBzaGFyZWRdKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKChjb2RlZFtcIiZkYXRhXCJdID8/IGNvZGVkKS5tYXAoKG0pID0+IHRoaXMuZGVjb2RlTWVtYmVyKG0sIHNoYXJlZCkpKTtcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgW1wib2JqZWN0XCIsIChbY29kZWQsIHNoYXJlZF0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoT2JqZWN0LmVudHJpZXMoY29kZWRbXCImZGF0YVwiXSA/PyBjb2RlZCkubWFwKChwYWlyKSA9PiB7IHJldHVybiBbcGFpclswXSwgdGhpcy5kZWNvZGVNZW1iZXIocGFpclsxXSwgc2hhcmVkKV07IH0pKS50aGVuKCgkKT0+e1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKCQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBbXCJ0eXBlZGFycmF5XCIsIChbY29kZWRdKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvZGVkPy5bXCImZGF0YVwiXSA/PyBjb2RlZDtcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgXG4gICAgICAgIF0pO1xuXG4gICAgICAgIC8vIFxuICAgICAgICB0aGlzLiR0cmFuc2NvZGluZ1J1bGVzID0gbmV3IE1hcChbXSk7XG4gICAgfVxuXG4gICAgLy9cbiAgICBhc3luYyBkZWNvZGVNZXNzYWdlKFskbWVzc2FnZSwgJGJ1ZmZlciA9IG51bGxdLCAkc2hhcmVkID0gW10pIHtcbiAgICAgICAgY29uc3QgX3Vud3JhcF8gPSBhd2FpdCAodGhpcy4kZGVjb2RlIHx8IChhc3luYyAoZSkgPT4geyBcbiAgICAgICAgICAgIHJldHVybiAoYXdhaXQgdGhpcy4kbXNncGNrKT8uZGVjb2RlKGUsIHt1c2VCaWdJbnQ2NDogdHJ1ZX0pOyBcbiAgICAgICAgfSkpPy4oYXdhaXQgJG1lc3NhZ2UpO1xuICAgICAgICBfdW53cmFwXy4kYXJncyA9IGF3YWl0IFByb21pc2UuYWxsKF91bndyYXBfLiRhcmdzPy5tYXA/LigobSkgPT4gdGhpcy5kZWNvZGVNZW1iZXIobSwgJHNoYXJlZCkpID8/IFtdKTtcbiAgICAgICAgcmV0dXJuIFtbX3Vud3JhcF8sICRidWZmZXJdLCAkc2hhcmVkLmNvbmNhdChbJGJ1ZmZlcl0pXTtcbiAgICB9XG5cbiAgICAvLyBUT0RPISBOZWVkcyBjbGllbnQtc2lkZSBlcnJvciBoYW5kbGluZy4uLlxuICAgIGRlY29kZUVycm9yKC4uLl8pIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJVbmhhbmRsZWQgaW50ZXJuYWwgZXJyb3IuLi5cIik7XG4gICAgfVxuXG4gICAgLy8gXG4gICAgYXN5bmMgZW5jb2RlRXJyb3IoWyRkYXRhLCAkYnVmZmVyXSwgJHNoYXJlZCA9IFtdKSB7XG4gICAgICAgIGRlbGV0ZSAkZGF0YT8uJGFyZ3M7XG4gICAgICAgIGRlbGV0ZSAkZGF0YT8uW1wiJmRhdGFcIl07XG4gICAgICAgIGNvbnN0IF93cmFwXyA9IGF3YWl0ICh0aGlzLiRlbmNvZGUgfHwgKCBhc3luYyAoZSkgPT4geyByZXR1cm4gKGF3YWl0IHRoaXMuJG1zZ3Bjayk/LmVuY29kZShlLCB7dXNlQmlnSW50NjQ6IHRydWV9KTsgfSkpPy4oJGRhdGEpO1xuICAgICAgICByZXR1cm4gW1tfd3JhcF8sICRidWZmZXJdLCAkc2hhcmVkLmNvbmNhdChbX3dyYXBfLmJ1ZmZlciwgJGJ1ZmZlcl0pXTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGFzeW5jIGRlY29kZU1lbWJlcihjb2RlZCwgc2hhcmVkID0gW10pIHtcbiAgICAgICAgLy8gaWYgaXMgbnVsbCwgcHJlZmVyIGRvbid0IGRlY29kZS4uLlxuICAgICAgICBjb2RlZCA9IGF3YWl0IGNvZGVkO1xuICAgICAgICBpZiAoIWNvZGVkIHx8IFtcIm9iamVjdFwiLCBcImZ1bmN0aW9uXCJdLmluZGV4T2YodHlwZW9mIGNvZGVkKSA8IDApIHJldHVybiBjb2RlZDtcbiAgICAgICAgaWYgKCFjb2RlZD8uW1wiJnR5cGVvZlwiXSkgY29kZWQgPSBuZXcgQXV0b0RldGVjdG9yKGNvZGVkKVtcIiZjb2RlXCJdO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0ICRzZW5kZXIgPSB0aGlzPy4kZ2V0RGF0YUNoYW5uZWw/Lihjb2RlZD8uW1wiJm1ldGFcIl0pO1xuICAgICAgICBjb25zdCAkcmVjb2RlID0gYXdhaXQgKHRoaXMuJGRlY29kaW5nUnVsZXMuZ2V0KGNvZGVkPy5bXCImdHlwZW9mXCJdKT8uKFtjb2RlZCwgc2hhcmVkXSwgeyRzZW5kZXJ9KSA/PyAoY29kZWQ/LltcIiZkYXRhXCJdKSA/PyBjb2RlZCk7XG4gICAgICAgICRzZW5kZXI/LiRmaW5hbGl6ZXI/LigkcmVjb2RlKTtcbiAgICAgICAgcmV0dXJuICRyZWNvZGU7XG4gICAgfVxuXG4gICAgLy9cbiAgICBhc3luYyBlbmNvZGVNZXNzYWdlKFskZGF0YSwgJGJ1ZmZlciA9IG51bGwsICRyZWNlaXZlID0gZmFsc2VdLCAkc2hhcmVkID0gW10pIHtcbiAgICAgICAgLy8kZGF0YS4kd29ya2VyID0gYXdhaXQgJGRhdGEuJHdvcmtlcjtcbiAgICAgICAgJGRhdGEuJGFyZ3MgPSBhd2FpdCBQcm9taXNlLmFsbCgkZGF0YS4kYXJncz8ubWFwPy4oKGUpID0+IHRoaXMuZW5jb2RlTWVtYmVyKGUsICRzaGFyZWQpKSA/PyBbXSk7XG4gICAgICAgIGNvbnN0IF93cmFwXyA9ICh0aGlzLiRlbmNvZGUgfHwgdGhpcy4kbXNncGNrPy5lbmNvZGUpKCRkYXRhLCB7dXNlQmlnSW50NjQ6IHRydWV9KTtcblxuICAgICAgICAvL1xuICAgICAgICBpZiAoJHJlY2VpdmUpIHsgLy8gd2hlbiByZWNlaXZlZCBieSByZW1vdGUsIG5lZWQgdG8gY29weSBidWZmZXJcbiAgICAgICAgICAgIGlmICgoJGJ1ZmZlci5ieXRlTGVuZ3RoLTgpIDwgX3dyYXBfLmJ5dGVMZW5ndGgpICRidWZmZXIuZ3Jvdyhfd3JhcF8uYnl0ZUxlbmd0aCs4KTtcbiAgICAgICAgICAgIGNvbnN0IF9jb3B5XyA9IG5ldyBVaW50OEFycmF5KCRidWZmZXIsIDgsIF93cmFwXy5ieXRlTGVuZ3RoKTsgX2NvcHlfLnNldChfd3JhcF8pO1xuICAgICAgICAgICAgY29uc3QgX2xlbl8gPSBuZXcgVWludDMyQXJyYXkoJGJ1ZmZlciwgMCwgMSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIEF0b21pY3MgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgIEF0b21pY3Muc3RvcmUoX2xlbl8sIDAsIF93cmFwXy5ieXRlTGVuZ3RoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgX2xlbl9bMF0gPSBfd3JhcF8uYnl0ZUxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbW19jb3B5XywgJGJ1ZmZlcl0sICRzaGFyZWQuY29uY2F0KFtfY29weV8uYnVmZmVyLCAkYnVmZmVyXSldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgX2NvcHlfID0gbmV3IFVpbnQ4QXJyYXkoX3dyYXBfKTtcbiAgICAgICAgICAgIHJldHVybiBbW19jb3B5XywgJGJ1ZmZlcl0sICRzaGFyZWQuY29uY2F0KFtfY29weV8uYnVmZmVyLCAkYnVmZmVyXSldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gXG4gICAgYXN5bmMgZW5jb2RlTWVtYmVyKCR3cmFwLCAkc2hhcmVkID0gW10pIHtcbiAgICAgICAgaWYgKFtcInRyYW5zZmVyXCIsIFwicHJvbWlzZVwiLCBcInByb3h5XCJdLmluZGV4T2YoJHdyYXA/LltcIiZ0eXBlb2ZcIl0pIDwgMCkge1xuICAgICAgICAgICAgJHdyYXAgPSBhd2FpdCAkdW53cmFwKGF3YWl0ICR3cmFwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoISR3cmFwIHx8IFtcIm9iamVjdFwiLCBcImZ1bmN0aW9uXCJdLmluZGV4T2YodHlwZW9mICR3cmFwKSA8IDApIHJldHVybiAkd3JhcDtcblxuICAgICAgICAvL1xuICAgICAgICBjb25zdCAkdW50eXBlZCA9ICR3cmFwO1xuICAgICAgICBsZXQgJHR5cGVvZiA9ICR3cmFwPy5bXCImdHlwZW9mXCJdO1xuICAgICAgICBpZiAoISR0eXBlb2YpIHtcbiAgICAgICAgICAgICR3cmFwID0gbmV3IEF1dG9EZXRlY3Rvcigkd3JhcCk7XG4gICAgICAgICAgICAkdHlwZW9mID0gJHdyYXA/LltcIiZ0eXBlb2ZcIl07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBcbiAgICAgICAgY29uc3QgJGNvZGUgPSAkd3JhcFtcIiZjb2RlXCJdO1xuICAgICAgICBjb25zdCAkcmVjZWl2ZXIgPSBhd2FpdCB0aGlzPy4kZ2V0RGF0YUNoYW5uZWw/LigkdW50eXBlZD8uW1wiJm1ldGFcIl0pOyAkcmVjZWl2ZXI/LiRmaW5hbGl6ZXI/LigkdW50eXBlZCk7XG4gICAgICAgIHJldHVybiAodGhpcy4kZW5jb2RpbmdSdWxlcy5nZXQoJHR5cGVvZik/LihbJGNvZGUsICRzaGFyZWRdLCB7JHdyYXAsICRyZWNlaXZlciwgJHVudHlwZWR9KSA/PyAoJHdyYXA/LltcIiZkYXRhXCJdKSk7XG4gICAgfVxufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQSxZOztBQUVBO0FBQ0EsU0FBU0EsUUFBUTtBQUNqQixPQUFPQyxZQUFZO0FBQ25CLFNBQVNDLEtBQUs7QUFDZCxTQUFTQyxPQUFPO0FBQ2hCLFNBQVNDLFFBQVEsRUFBRUMsZ0JBQWdCO0FBQ25DLE9BQU9DLFdBQVcsSUFBSUMs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
